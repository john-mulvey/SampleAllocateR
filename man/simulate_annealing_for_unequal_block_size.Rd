% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/main.R
\name{simulate_annealing_for_unequal_block_size}
\alias{simulate_annealing_for_unequal_block_size}
\title{Simulated Annealing Allocation for Unequal Block Sizes (Internal Function)}
\usage{
simulate_annealing_for_unequal_block_size(
  data,
  covariates,
  blocking_variable = NA,
  batch_size,
  temperature,
  cooling_rate,
  iterations,
  plot = TRUE,
  balance_metric = "harmonic_mean"
)
}
\arguments{
\item{data}{A data.frame containing the dataset to be allocated. Must include a sample_id column.}

\item{covariates}{A character vector listing the covariate column names to balance.}

\item{blocking_variable}{Optional string specifying the blocking variable column name.
If NA or missing, no blocking is applied.}

\item{batch_size}{Integer specifying the size of each batch.}

\item{temperature}{Numeric specifying the initial temperature for the annealing process.}

\item{cooling_rate}{Numeric between 0 and 1 specifying the rate at which temperature decreases.}

\item{iterations}{Integer specifying the number of iterations to run.}

\item{plot}{Logical indicating whether to plot optimization progress. Default is TRUE.}

\item{balance_metric}{Character string specifying the metric to use ("harmonic_mean" or "product").}
}
\value{
A list with three elements:
\itemize{
\item layout: data.frame with batch_allocation column added (may include padding rows)
\item results: data.frame with covariate balance test results
\item optimisation_data: data.frame tracking the optimization process across iterations
}
}
\description{
This function approximates simulated annealing to extends the standard simulated annealing approach to handle
blocking variables with unequal block sizes. The swapping routine enables swapping of up to 2 blocks between
batches, and can additionally move empty "padding" samples if required. this helps to
prevent the algorithm becoming stuck in local optima.
}
\details{
This function addresses the complex problem of optimizing batch allocation when blocks
have unequal sizes.

The algorithm considers four swap scenarios:

\strong{Scenario 1:} Single block vs single block (with optional padding)

\strong{Scenario 2:} Single block vs two blocks (with optional padding)

\strong{Scenario 3:} Two blocks vs single block (with optional padding)

\strong{Scenario 4:} Two blocks vs two blocks (with optional padding)

For each iteration, the algorithm:
\enumerate{
\item Identifies all possible swaps between two randomly selected batches
\item Randomly selects one valid swap
\item Evaluates the swap using the balance score
\item Accepts or rejects based on simulated annealing criteria
}

Swaps are constrained to involve fewer than half the samples in a batch to maintain
diversity across batches.
}
\keyword{internal}
